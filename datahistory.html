<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Earnings Details - TRUST BD</title>

<!-- Google Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">

<!-- Tailwind CSS -->
<script src="https://cdn.tailwindcss.com"></script>

<style>
body {
  font-family: 'Inter', sans-serif;
  background: linear-gradient(135deg, #f0f4ff, #e0e7ff);
  min-height: 100vh;
  overflow-x: hidden;
}

.header {
  background: linear-gradient(90deg,#4f46e5,#3b82f6);
  color: white;
  padding: 1rem;
  position: sticky;
  top:0;
  z-index:50;
  border-bottom-left-radius: 20px;
  border-bottom-right-radius: 20px;
}
.header img {
  width: 100%;
  max-height: 140px;
  object-fit: cover;
  border-radius: 16px;
  margin-top: 0.5rem;
}
.back-btn {
  display: inline-flex;
  align-items: center;
  gap:0.5rem;
  background: rgba(255,255,255,0.2);
  padding:0.4rem 0.8rem;
  border-radius:12px;
  cursor:pointer;
  transition: all 0.3s ease;
}
.back-btn:hover {
  background: rgba(255,255,255,0.35);
  transform: scale(1.05);
}

/* Compact Premium Card */
.card {
  position: relative;
  backdrop-filter: blur(15px);
  border-radius: 20px;
  padding: 1rem;
  margin-bottom: 1rem;
  box-shadow: 0 12px 25px rgba(0,0,0,0.08), 0 6px 15px rgba(0,0,0,0.05);
  transition: all 0.3s ease-in-out;
  display: flex;
  justify-content: space-between;
  align-items: center;
}
.card:hover {
  transform: translateY(-4px);
  box-shadow: 0 20px 45px rgba(0,0,0,0.12), 0 10px 30px rgba(0,0,0,0.08);
}

/* Gradient Colors */
.card.positive {
  background: linear-gradient(135deg, rgba(52,211,153,0.25), rgba(16,185,129,0.15));
}
.card.negative {
  background: linear-gradient(135deg, rgba(239,68,68,0.25), rgba(220,38,38,0.15));
}

/* Icon */
.icon-circle {
  width: 50px;
  height: 50px;
  border-radius: 50%;
  overflow: hidden;
  flex-shrink: 0;
  border: 2px solid rgba(255,255,255,0.6);
  backdrop-filter: blur(8px);
  box-shadow: 0 3px 10px rgba(0,0,0,0.08);
  transition: transform 0.3s;
}
.icon-circle img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}
.card:hover .icon-circle {
  transform: scale(1.1);
}

/* Text */
.card h2 {
  font-size: 1rem;
  font-weight: 600;
  color: #111827;
}
.card p, .card span {
  font-size: 0.75rem;
  color: #6b7280;
}
.amount-positive {
  color: #16a34a;
  font-weight: 600;
  font-size: 1.15rem;
  text-align: right;
}
.amount-negative {
  color: #dc2626;
  font-weight: 600;
  font-size: 1.15rem;
  text-align: right;
}

/* Badge */
.badge {
  position: absolute;
  top: 8px;
  right: 8px;
  background: rgba(255,255,255,0.2);
  backdrop-filter: blur(6px);
  padding: 0.15rem 0.5rem;
  border-radius: 10px;
  font-size: 0.65rem;
  font-weight: 600;
  color: #111827;
}

/* Smooth scrolling */
main {
  scroll-behavior: smooth;
  -webkit-overflow-scrolling: touch;
}

/* Scrollbar */
main::-webkit-scrollbar {
  width: 6px;
}
main::-webkit-scrollbar-track {
  background: transparent;
}
main::-webkit-scrollbar-thumb {
  background: rgba(79,70,229,0.4);
  border-radius: 3px;
}
</style>
</head>
<body class="min-h-screen flex flex-col">

<header class="header">
  <div class="flex items-center justify-between">
    <div class="back-btn" onclick="window.location.href='profile.html'">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
      </svg>
      <span>Back</span>
    </div>
    <h1 class="text-lg font-bold text-white">Earnings Details</h1>
  </div>
  <img src="https://i.postimg.cc/mhWcd1rh/Picsart-25-09-09-10-52-46-930.jpg" alt="Banner Image">
</header>

<main class="flex-1 p-4 overflow-y-auto">
  <div class="max-w-md mx-auto" id="messagesContainer"></div>
  <div id="emptyState" class="text-center text-gray-400 mt-10 hidden">কোনও মেসেজ নেই।</div>
</main>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.4.0/firebase-app.js";
import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/10.4.0/firebase-database.js";
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.4.0/firebase-auth.js";

const firebaseConfig = {
  apiKey: "AIzaSyBCyR4yHRj4Yze2-M27tktHtV_f03EoVvs",
  authDomain: "trust-bd-d889e.firebaseapp.com",
  databaseURL: "https://trust-bd-d889e-default-rtdb.firebaseio.com",
  projectId: "trust-bd-d889e",
  storageBucket: "trust-bd-d889e.appspot.com",
  messagingSenderId: "413112954640",
  appId: "1:413112954640:web:beb99410c8b9ecd4037f95",
  measurementId: "G-8JEWWCZ0Y4"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);
const auth = getAuth(app);

const messagesContainer = document.getElementById('messagesContainer');
const emptyState = document.getElementById('emptyState');

onAuthStateChanged(auth, (user) => {
  if (user) {
    const uid = user.uid;
    const messagesRef = ref(db, `earnings/${uid}/messages`);

    onValue(messagesRef, (snapshot) => {
      messagesContainer.innerHTML = '';
      if(snapshot.exists()){
        emptyState.classList.add('hidden');
        let count = 1;
        const messages = [];
        snapshot.forEach(child => { messages.push({...child.val(), key: child.key}); });
        messages.sort((a,b)=> a.timestamp - b.timestamp);

        messages.forEach(msg => {
          const card = document.createElement('div');
          card.className = msg.amount >= 0 ? 'card positive' : 'card negative';
          card.innerHTML = `
            <div class="flex items-center space-x-3">
              <div class="icon-circle">
                <img src="${msg.icon || 'https://via.placeholder.com/50'}" alt="icon">
              </div>
              <div>
                <p class="text-gray-400 text-xs font-medium">#${count}</p>
                <h2 class="font-semibold">${msg.subject}</h2>
                <span class="text-gray-400 text-xs">${msg.date} ${msg.time}</span>
              </div>
            </div>
            <div class="text-right">
              <p class="${msg.amount >=0 ? 'amount-positive' : 'amount-negative'}">${msg.amount} BDT</p>
            </div>
            ${msg.amount >=0 ? '<div class="badge">+Earning</div>' : '<div class="badge">- Invest</div>'}
          `;
          messagesContainer.appendChild(card);
          count++;
        });
      } else {
        emptyState.classList.remove('hidden');
      }
    });

  } else {
    window.location.href = "index.html";
  }
});
</script>

</body>
</html>
