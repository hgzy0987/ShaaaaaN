<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Earnings Details - TRUST BD</title>

<!-- Google Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

<!-- Tailwind CSS -->
<script src="https://cdn.tailwindcss.com"></script>

<style>
body { font-family: 'Inter', sans-serif; background-color: #f3f4f6; }
.header { background: linear-gradient(90deg,#4f46e5,#3b82f6); color: white; padding: 1rem; position: sticky; top:0; z-index:50; }
.header img { width: 100%; max-height: 150px; object-fit: cover; border-radius: 12px; margin-top: 0.5rem; }
.back-btn { display: inline-flex; align-items: center; gap:0.5rem; background: rgba(255,255,255,0.2); padding:0.5rem 1rem; border-radius:8px; cursor:pointer; transition: background 0.2s; }
.back-btn:hover { background: rgba(255,255,255,0.4); }
.card { background: white; border-radius: 16px; padding: 1rem; box-shadow: 0 6px 20px rgba(0,0,0,0.1); margin-bottom: 1rem; transition: transform 0.2s, box-shadow 0.2s; }
.card:hover { transform: translateY(-2px); box-shadow: 0 10px 25px rgba(0,0,0,0.15); }
.amount-positive { color: #16a34a; font-weight: 600; }
.amount-negative { color: #dc2626; font-weight: 600; }
.icon-circle { width: 50px; height: 50px; border-radius: 50%; overflow: hidden; flex-shrink: 0; }
</style>
</head>
<body class="min-h-screen flex flex-col">

<header class="header">
  <div class="flex items-center justify-between">
    <div class="back-btn" onclick="window.location.href='profile.html'">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
      </svg>
      <span>Back</span>
    </div>
    <h1 class="text-xl font-bold text-white">Earnings Details</h1>
  </div>
  <img src="https://i.postimg.cc/mhWcd1rh/Picsart-25-09-09-10-52-46-930.jpg" alt="Banner Image">
</header>

<main class="flex-1 p-4 overflow-y-auto">
  <div class="max-w-lg mx-auto" id="messagesContainer"></div>
  <div id="emptyState" class="text-center text-gray-400 mt-10 hidden">কোনও মেসেজ নেই।</div>
</main>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.4.0/firebase-app.js";
import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/10.4.0/firebase-database.js";
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.4.0/firebase-auth.js";

const firebaseConfig = {
  apiKey: "AIzaSyBCyR4yHRj4Yze2-M27tktHtV_f03EoVvs",
  authDomain: "trust-bd-d889e.firebaseapp.com",
  databaseURL: "https://trust-bd-d889e-default-rtdb.firebaseio.com",
  projectId: "trust-bd-d889e",
  storageBucket: "trust-bd-d889e.appspot.com",
  messagingSenderId: "413112954640",
  appId: "1:413112954640:web:beb99410c8b9ecd4037f95",
  measurementId: "G-8JEWWCZ0Y4"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);
const auth = getAuth(app);

const messagesContainer = document.getElementById('messagesContainer');
const emptyState = document.getElementById('emptyState');

onAuthStateChanged(auth, (user) => {
  if (user) {
    const uid = user.uid;
    const messagesRef = ref(db, `earnings/${uid}/messages`);

    onValue(messagesRef, (snapshot) => {
      messagesContainer.innerHTML = '';
      if(snapshot.exists()){
        emptyState.classList.add('hidden');
        let count = 1;
        const messages = [];
        snapshot.forEach(child => { messages.push({...child.val(), key: child.key}); });
        messages.sort((a,b)=> a.timestamp - b.timestamp);

        messages.forEach(msg => {
          const card = document.createElement('div');
          card.className = 'card flex justify-between items-center';
          card.innerHTML = `
            <div class="flex items-center space-x-3">
              <div class="icon-circle">
                <img src="${msg.icon || 'https://via.placeholder.com/50'}" alt="icon" class="w-full h-full object-cover">
              </div>
              <div>
                <p class="text-gray-400 text-sm">#${count}</p>
                <h2 class="font-semibold text-gray-800">${msg.subject}</h2>
                <span class="text-gray-400 text-sm">${msg.date} ${msg.time}</span>
              </div>
            </div>
            <div>
              <p class="${msg.amount >=0 ? 'amount-positive' : 'amount-negative'} text-lg">${msg.amount} BDT</p>
            </div>
          `;
          messagesContainer.appendChild(card);
          count++;
        });
      } else {
        emptyState.classList.remove('hidden');
      }
    });

  } else {
    // ইউজার লগ ইন না থাকলে
    window.location.href = "index.html";
  }
});
</script>

</body>
</html>
